<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniMath - Aplikasi Matematika All-in-One</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS ASLI DIPERTAHANKAN */
        :root {
            --primary: #020617;
            --secondary: #0f172a;
            --accent: #3b82f6;
            --light: #f8fafc;
            --text: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --glass: rgba(2, 6, 23, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --nav-bg: rgba(15, 23, 42, 0.8);
            --nav-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, var(--primary), #1e293b);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        body.light-mode {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: #1e293b;
        }

        body.light-mode .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.6);
            color: #1e293b;
            box-shadow: 0 8px 32px rgba(15, 23, 42, 0.1);
        }

        body.light-mode .glass-card h2,
        body.light-mode .glass-card h3 {
            color: #1e40af;
        }

        body.light-mode .nav-btn.active {
            background: rgba(59, 130, 246, 0.15);
            color: #1e40af;
        }

        body.light-mode .formula-card {
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .btn {
            background: #1e40af;
            color: white;
        }

        body.light-mode .btn:hover {
            background: #3730a3;
        }

        body.light-mode .calculator-display {
            background: #f8fafc;
            color: #1e293b;
            border: 1px solid #e2e8f0;
        }

        body.light-mode .converter-input,
        body.light-mode .converter-select {
            background: #f8fafc;
            color: #1e293b;
            border: 1px solid #e2e8f0;
        }

        body.light-mode .exercise-question {
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .note-editor {
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .music-player {
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b;
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .mobile-nav {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .nav-btn {
            color: #475569;
        }

        body.light-mode .nav-btn.active {
            background: rgba(59, 130, 246, 0.15);
            color: #1e40af;
        }

        body.light-mode .theme-toggle {
            background: rgba(100, 116, 139, 0.1);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        body.light-mode .theme-toggle:hover {
            background: rgba(100, 116, 139, 0.2);
        }

        body.light-mode .category-card,
        body.light-mode .exercise-option,
        body.light-mode .note-folder,
        body.light-mode .quiz-card {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(226, 232, 240, 0.6);
            color: #475569;
        }

        body.light-mode .category-card:hover,
        body.light-mode .exercise-option:hover,
        body.light-mode .note-folder:hover,
        body.light-mode .quiz-card:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }

        body.light-mode .calculator-btn {
            background: rgba(100, 116, 139, 0.1);
            color: #475569;
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        body.light-mode .calculator-btn:hover {
            background: rgba(100, 116, 139, 0.2);
        }

        body.light-mode .calculator-btn.operator {
            background: rgba(59, 130, 246, 0.15);
        }

        body.light-mode .calculator-btn.function {
            background: rgba(16, 185, 129, 0.15);
        }

        body.light-mode .calculator-btn.equals {
            background: var(--success);
            color: white;
        }

        body.light-mode .calculator-btn.clear {
            background: var(--danger);
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(2, 6, 23, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 28px;
            color: var(--accent);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--accent), #60a5fa);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* XP Display */
        .xp-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        .xp-progress {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .xp-progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s ease;
        }

        body.light-mode .xp-display {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .xp-progress {
            background: rgba(100, 116, 139, 0.2);
        }

        /* Navigation */
        .nav-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 999;
        }

        .desktop-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px 20px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(2, 6, 23, 0.3);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--text);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Mobile Navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--nav-border);
            border-radius: 20px 20px 0 0;
            padding: 15px;
            box-shadow: 0 -8px 32px rgba(2, 6, 23, 0.3);
            z-index: 1000;
            transform: translateY(0);
            transition: transform 0.3s ease;
        }

        .mobile-nav-buttons {
            display: flex;
            justify-content: space-around;
        }

        .mobile-nav-btn {
            background: transparent;
            border: none;
            color: var(--text);
            padding: 10px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
        }

        .mobile-nav-btn.active {
            color: var(--accent);
        }

        .mobile-nav-btn i {
            font-size: 20px;
        }

        /* Content Sections */
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
            padding-top: 80px;
            padding-bottom: 80px;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(2, 6, 23, 0.3);
        }

        .glass-card h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .glass-card h3 {
            color: var(--accent);
            margin: 15px 0 10px;
            font-size: 1.3rem;
        }

        /* Formula Library */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent);
        }

        .category-card h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .category-card ul {
            list-style: none;
            padding-left: 0;
        }

        .category-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .category-card li:last-child {
            border-bottom: none;
        }

        .category-card li:hover {
            color: var(--accent);
        }

        .formula-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .formula-card .formula-name {
            font-weight: 600;
        }

        .load-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .load-btn:hover {
            background: #2563eb;
        }

        /* Formula Explainer */
        .formula-explainer {
            margin-top: 30px;
            border-top: 1px solid var(--glass-border);
            padding-top: 20px;
        }

        .formula-explainer-content {
            display: none;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--glass-border);
        }

        .formula-explainer-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .formula-explanation {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .formula-explanation:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .formula-explanation h4 {
            color: var(--accent);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.light-mode .formula-explainer-content {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(226, 232, 240, 0.6);
        }

        body.light-mode .formula-explanation {
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }

        /* Graph Simulator */
        .graph-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
        }

        #graphCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .graph-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #2563eb;
        }

        .btn:disabled {
            background: #4b5563;
            cursor: not-allowed;
        }

        .coordinate-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 10;
        }

        /* Calculator */
        .calculator {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-width: 300px;
            margin: 0 auto;
        }

        .calculator-display {
            grid-column: span 4;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: right;
            font-size: 1.5rem;
            min-height: 60px;
            word-wrap: break-word;
            word-break: break-all;
        }

        .calculator-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 15px;
            border-radius: 8px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calculator-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calculator-btn.operator {
            background: rgba(59, 130, 246, 0.3);
        }

        .calculator-btn.function {
            background: rgba(16, 185, 129, 0.3);
        }

        .calculator-btn.equals {
            background: var(--success);
        }

        .calculator-btn.clear {
            background: var(--danger);
        }

        /* Converter */
        .converter-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: end;
        }

        .converter-input {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            color: var(--text);
            font-size: 1rem;
            width: 100%;
        }

        .converter-select {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--glass-border);
            color: var(--text);
            font-size: 1rem;
            width: 100%;
        }

        .converter-arrow {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: var(--accent);
        }

        /* Exercise Section */
        .exercise-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .exercise-question {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .exercise-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .exercise-option {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .exercise-option:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .exercise-option.selected {
            background: var(--accent);
        }

        .exercise-option.correct {
            background: var(--success);
        }

        .exercise-option.incorrect {
            background: var(--danger);
        }

        .exercise-feedback {
            text-align: center;
            margin: 15px 0;
            min-height: 24px;
        }

        .exercise-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .exercise-progress {
            flex: 1;
            margin: 0 10px;
        }

        .exercise-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .exercise-progress-fill {
            height: 100%;
            background: var(--success);
            width: 0%;
            transition: width 0.3s ease;
        }

        .exercise-result {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }

        .exercise-explanation {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        .submit-btn {
            display: block;
            margin: 15px auto;
            width: 200px;
        }

        /* Notes Section */
        .note-folders {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .note-folder {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .note-folder:hover {
            transform: translateY(-3px);
            background: rgba(59, 130, 246, 0.1);
        }

        .note-folder.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: var(--accent);
        }

        .note-folder h4 {
            margin: 0 0 5px;
            font-size: 1rem;
        }

        .note-folder p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .note-folder-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .note-folder-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Music Player */
        .music-player {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -60%);
            width: 90%;
            max-width: 500px;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 25px;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .music-player.show {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%);
        }

        .music-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .music-progress {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
        }

        .music-info {
            text-align: center;
            margin: 10px 0;
        }

        .music-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .music-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .music-btn.play {
            width: 50px;
            height: 50px;
            background: var(--accent);
        }

        .close-music {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .playlist {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .playlist-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .playlist-item.active {
            background: rgba(59, 130, 246, 0.2);
        }

        .upload-music {
            margin-top: 15px;
        }

        /* Floating Action Button - PERBAIKAN: posisi diubah */
        .fab {
            position: fixed;
            bottom: 120px; /* Diubah dari 80px menjadi 120px */
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            border: none;
            font-size: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .fab:hover {
            transform: scale(1.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .desktop-nav {
                display: none;
            }

            .mobile-nav {
                display: block;
            }

            .converter-container {
                grid-template-columns: 1fr;
            }

            .exercise-options {
                grid-template-columns: 1fr;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }

            .calculator {
                max-width: 100%;
            }
            
            /* Mobile-specific fixes */
            .section {
                padding-top: 120px;
                padding-bottom: 100px;
            }
            
            .nav-container {
                top: 0;
                position: fixed;
            }
            
            /* Perbaikan untuk navbar mobile */
            .mobile-nav {
                padding: 15px 10px;
            }
            
            .mobile-nav-btn {
                padding: 8px;
                font-size: 12px;
            }

            .xp-display {
                font-size: 0.8rem;
            }

            .xp-progress {
                width: 70px;
            }
        }

        @media (min-width: 769px) {
            .mobile-nav {
                display: none;
            }
        }

        /* Animasi tambahan untuk konten */
        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.6s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Animasi masuk aplikasi - PERBAIKAN: animasi berputar diganti dengan lompat-lompat, loading bar dihapus */
        .app-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .app-logo {
            width: 150px;
            height: 150px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            animation: bounceLogo 2s infinite; /* Animasi berputar diganti dengan bounce */
            overflow: hidden;
        }
        
        .app-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* Animasi bounce untuk logo (mengganti rotate) */
        @keyframes bounceLogo {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .app-slogan {
            font-size: 1.2rem;
            color: var(--text);
            text-align: center;
            margin-bottom: 30px;
            animation: slideInUp 1s ease-out;
            position: relative;
        }
        
        .app-slogan::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 2px;
            background: var(--accent);
            animation: expandWidth 2s ease-out forwards;
        }
        
        @keyframes expandWidth {
            0% { width: 0; }
            100% { width: 200px; }
        }
        
        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .app-loading.hide {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Loading progress bar - PERBAIKAN: dihapus */
        /* .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 20px;
        }
        
        .loading-progress-bar {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
            animation: loadingProgress 3s ease-in-out forwards;
        }
        
        @keyframes loadingProgress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        } */
        
        /* Quiz Selection */
        .quiz-selection {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .quiz-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .quiz-card:hover {
            transform: translateY(-5px);
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent);
        }
        
        .quiz-card h4 {
            margin-bottom: 10px;
            color: var(--accent);
        }
        
        .quiz-card p {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .note-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .note-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            color: var(--text);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .note-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .note-editor {
            min-height: 200px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        #noteContent {
            min-height: 150px;
            outline: none;
        }
        
        .upload-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .upload-btn:hover {
            background: #2563eb;
        }
        
        /* Music Player Header */
        .music-player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .music-player-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .music-player-cover {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .music-player-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .music-player-info {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .music-player-info #currentTrack {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .music-player-info .music-player-artist {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .music-volume {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .music-volume-slider {
            flex: 1;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .music-volume-slider-fill {
            height: 100%;
            background: var(--accent);
            width: 70%;
        }
        
        .music-time {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Animasi motion design */
        .motion-design {
            animation: motionDesign 2s ease-out;
        }
        
        @keyframes motionDesign {
            0% { 
                transform: scale(0.8) rotate(-10deg);
                opacity: 0;
            }
            50% { 
                transform: scale(1.1) rotate(5deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* Header Center Layout */
        .header-center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 20px;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            overflow: hidden;
        }

        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* App Switcher Button - PERBAIKAN */
        .app-switcher {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .app-switcher:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .app-switcher i {
            font-size: 1.2rem;
            color: var(--accent);
        }
        
        body.light-mode .app-switcher {
            background: rgba(100, 116, 139, 0.1);
        }
        
        body.light-mode .app-switcher:hover {
            background: rgba(100, 116, 139, 0.2);
        }
        
        /* Enhanced animations - TAMBAHAN */
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 0.8; }
            70% { transform: scale(0.9); opacity: 0.9; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .flip-in {
            animation: flipIn 0.8s ease-out;
        }
        
        @keyframes flipIn {
            0% { transform: perspective(400px) rotateY(90deg); opacity: 0; }
            40% { transform: perspective(400px) rotateY(-10deg); opacity: 0.8; }
            70% { transform: perspective(400px) rotateY(10deg); opacity: 0.9; }
            100% { transform: perspective(400px) rotateY(0deg); opacity: 1; }
        }
        
        .zoom-in {
            animation: zoomIn 0.6s ease-out;
        }
        
        @keyframes zoomIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .stagger-item {
            opacity: 0;
            transform: translateY(20px);
            animation: staggerItem 0.5s ease-out forwards;
        }
        
        @keyframes staggerItem {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen dengan animasi yang diperbaiki -->
    <div class="app-loading" id="appLoading">
        <div class="app-logo">
            <img src="https://dl.dropbox.com/scl/fi/6cclpxixx9i0bwe6fqiy2/138670.png?rlkey=4diq6bs3u9yoi1d6mzyvckvw3&st=4t9qrc9t&dl=1" alt="OmniMath Logo">
        </div>
        <div class="app-slogan"> OmniMath<br></div>
        <!-- Loading bar dihapus sesuai permintaan -->
    </div>

    <!-- Navigation -->
    <div class="nav-container">
        <header>
            <div class="header-center">
                <div class="header-logo">
                    <img src="https://dl.dropbox.com/scl/fi/6cclpxixx9i0bwe6fqiy2/138670.png?rlkey=4diq6bs3u9yoi1d6mzyvckvw3&st=4t9qrc9t&dl=1" alt="Logo">
                </div>
                <div class="xp-display">
                    <i class="fas fa-star"></i>
                    <span>Level <span id="levelDisplay">1</span></span>
                    <div class="xp-progress">
                        <div class="xp-progress-fill" id="xpBar"></div>
                    </div>
                    <span><span id="xpDisplay">0</span>/<span id="nextLevelXp">100</span> XP</span>
                </div>
                <!-- PERBAIKAN: Ganti logo kanan dengan app switcher -->
                <div class="app-switcher" id="appSwitcher">
                    <i class="fas fa-th"></i>
                </div>
            </div>
            <div class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </div>
        </header>
        
        <nav class="desktop-nav">
            <button class="nav-btn active" data-target="library">
                <i class="fas fa-book"></i> Perpustakaan
            </button>
            <button class="nav-btn" data-target="simulator">
                <i class="fas fa-chart-line"></i> Simulator Grafik
            </button>
            <button class="nav-btn" data-target="tools">
                <i class="fas fa-tools"></i> Alat
            </button>
            <button class="nav-btn" data-target="exercise">
                <i class="fas fa-graduation-cap"></i> Latihan
            </button>
            <button class="nav-btn" data-target="notes">
                <i class="fas fa-sticky-note"></i> Catatan
            </button>
        </nav>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-buttons">
            <button class="mobile-nav-btn active" data-target="library">
                <i class="fas fa-book"></i>
                <span>Perpustakaan</span>
            </button>
            <button class="mobile-nav-btn" data-target="simulator">
                <i class="fas fa-chart-line"></i>
                <span>Simulator</span>
            </button>
            <button class="mobile-nav-btn" data-target="tools">
                <i class="fas fa-tools"></i>
                <span>Alat</span>
            </button>
            <button class="mobile-nav-btn" data-target="exercise">
                <i class="fas fa-graduation-cap"></i>
                <span>Latihan</span>
            </button>
            <button class="mobile-nav-btn" data-target="notes">
                <i class="fas fa-sticky-note"></i>
                <span>Catatan</span>
            </button>
        </div>
    </nav>

    <!-- Content Sections -->
    <div class="container">
        <!-- Library Section - PERBAIKAN: animasi dihapus -->
        <section id="library" class="section active">
            <div class="glass-card">
                <h2><i class="fas fa-book"></i> Perpustakaan Rumus</h2>
                <p>Temukan rumus matematika dan fisika dalam berbagai kategori</p>
                
                <div class="categories-grid">
                    <div class="category-card">
                        <h3><i class="fas fa-square-root-alt"></i> Aljabar</h3>
                        <ul>
                            <li class="formula-item" data-formula="quadratic">Rumus Kuadrat</li>
                            <li class="formula-item" data-formula="linear">Persamaan Linear</li>
                            <li class="formula-item" data-formula="polynomial">Polinomial</li>
                        </ul>
                    </div>
                    
                    <div class="category-card">
                        <h3><i class="fas fa-wave-square"></i> Trigonometri</h3>
                        <ul>
                            <li class="formula-item" data-formula="sin">Fungsi Sinus</li>
                            <li class="formula-item" data-formula="cos">Fungsi Cosinus</li>
                            <li class="formula-item" data-formula="tan">Fungsi Tangen</li>
                        </ul>
                    </div>
                    
                    <div class="category-card">
                        <h3><i class="fas fa-atom"></i> Fisika</h3>
                        <ul>
                            <li class="formula-item" data-formula="newton">Hukum Newton</li>
                            <li class="formula-item" data-formula="energy">Energi Kinetik</li>
                            <li class="formula-item" data-formula="motion">Gerak Lurus</li>
                        </ul>
                    </div>
                    
                    <div class="category-card">
                        <h3><i class="fas fa-calculator"></i> Geometri</h3>
                        <ul>
                            <li class="formula-item" data-formula="circle">Luas Lingkaran</li>
                            <li class="formula-item" data-formula="triangle">Luas Segitiga</li>
                            <li class="formula-item" data-formula="rectangle">Luas Persegi Panjang</li>
                        </ul>
                    </div>
                </div>
                
                <div class="formulas-list">
                    <h3>Rumus Tersedia</h3>
                    <div class="formula-card">
                        <div class="formula-name">Rumus Kuadrat: x = (-b ± √(b²-4ac)) / 2a</div>
                        <button class="load-btn" data-formula="quadratic">LOAD</button>
                    </div>
                    <div class="formula-card">
                        <div class="formula-name">Fungsi Sinus: y = sin(x)</div>
                        <button class="load-btn" data-formula="sin">LOAD</button>
                    </div>
                    <div class="formula-card">
                        <div class="formula-name">Luas Lingkaran: A = πr²</div>
                        <button class="load-btn" data-formula="circle">LOAD</button>
                    </div>
                    <div class="formula-card">
                        <div class="formula-name">Energi Kinetik: KE = ½mv²</div>
                        <button class="load-btn" data-formula="energy">LOAD</button>
                    </div>
                </div>

                <!-- Formula Explainer Section -->
                <div class="formula-explainer">
                    <button class="btn" id="formulaExplainerBtn">
                        <i class="fas fa-lightbulb"></i> Formula Explainer
                    </button>
                    <div class="formula-explainer-content" id="formulaExplainerContent">
                        <h3>Penjelasan Rumus Dasar</h3>
                        <div class="formula-explanation">
                            <h4><i class="fas fa-square-root-alt"></i> Rumus Kuadrat</h4>
                            <p>Rumus kuadrat digunakan untuk mencari akar-akar persamaan kuadrat berbentuk ax² + bx + c = 0. Diskriminan (b² - 4ac) menentukan jenis akar: positif (dua akar real berbeda), nol (satu akar real), atau negatif (dua akar kompleks).</p>
                        </div>
                        <div class="formula-explanation">
                            <h4><i class="fas fa-wave-square"></i> Fungsi Trigonometri</h4>
                            <p>Fungsi sinus, cosinus, dan tangen adalah fungsi dasar dalam trigonometri yang menghubungkan sudut dengan perbandingan sisi-sisi segitiga siku-siku. Fungsi-fungsi ini bersifat periodik dengan periode 2π radian atau 360°.</p>
                        </div>
                        <div class="formula-explanation">
                            <h4><i class="fas fa-atom"></i> Energi Kinetik</h4>
                            <p>Energi kinetik adalah energi yang dimiliki benda karena geraknya. Rumus KE = ½mv² menunjukkan bahwa energi kinetik sebanding dengan massa benda dan kuadrat kecepatannya. Satuan energi kinetik adalah joule (J).</p>
                        </div>
                        <div class="formula-explanation">
                            <h4><i class="fas fa-calculator"></i> Luas Lingkaran</h4>
                            <p>Luas lingkaran dihitung dengan rumus A = πr², di mana r adalah jari-jari lingkaran. Nilai π (pi) adalah konstanta matematika yang bernilai sekitar 3.14159, yang merupakan perbandingan keliling lingkaran dengan diameternya.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Simulator Section - PERBAIKAN: animasi dihapus -->
        <section id="simulator" class="section">
            <div class="glass-card">
                <h2><i class="fas fa-chart-line"></i> Simulator Grafik</h2>
                <p>Gambar dan analisis grafik fungsi matematika</p>
                
                <div class="graph-container">
                    <canvas id="graphCanvas"></canvas>
                    <div class="coordinate-display">Koordinat: (0, 0)</div>
                </div>
                
                <div class="graph-controls">
                    <input type="text" id="functionInput" placeholder="Masukkan fungsi (mis: x^2, sin(x), 2*x+3)" style="flex: 1; padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.1);">
                    <button id="plotBtn" class="btn">GAMBAR</button>
                    <button id="clearBtn" class="btn">BERSIHKAN</button>
                    <button id="zoomInBtn" class="btn">+</button>
                    <button id="zoomOutBtn" class="btn">-</button>
                    <button id="resetViewBtn" class="btn">ATUR ULANG</button>
                </div>
            </div>
        </section>

        <!-- Tools Section - PERBAIKAN: animasi dihapus -->
        <section id="tools" class="section">
            <div class="glass-card">
                <h2><i class="fas fa-tools"></i> Alat Matematika</h2>
                <p>Kalkulator ilmiah dan konverter satuan</p>
                
                <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                    <div style="flex: 1; min-width: 300px;">
                        <h3><i class="fas fa-calculator"></i> Kalkulator Ilmiah</h3>
                        <div class="calculator">
                            <div class="calculator-display" id="calcDisplay">0</div>
                            <button class="calculator-btn clear" onclick="clearDisplay()">C</button>
                            <button class="calculator-btn" onclick="appendToDisplay('(')">(</button>
                            <button class="calculator-btn" onclick="appendToDisplay(')')">)</button>
                            <button class="calculator-btn operator" onclick="appendToDisplay('/')">/</button>
                            
                            <button class="calculator-btn function" onclick="appendToDisplay('sin(')">sin</button>
                            <button class="calculator-btn function" onclick="appendToDisplay('cos(')">cos</button>
                            <button class="calculator-btn function" onclick="appendToDisplay('tan(')">tan</button>
                            <button class="calculator-btn operator" onclick="appendToDisplay('*')">×</button>
                            
                            <button class="calculator-btn" onclick="appendToDisplay('7')">7</button>
                            <button class="calculator-btn" onclick="appendToDisplay('8')">8</button>
                            <button class="calculator-btn" onclick="appendToDisplay('9')">9</button>
                            <button class="calculator-btn operator" onclick="appendToDisplay('-')">-</button>
                            
                            <button class="calculator-btn" onclick="appendToDisplay('4')">4</button>
                            <button class="calculator-btn" onclick="appendToDisplay('5')">5</button>
                            <button class="calculator-btn" onclick="appendToDisplay('6')">6</button>
                            <button class="calculator-btn operator" onclick="appendToDisplay('+')">+</button>
                            
                            <button class="calculator-btn" onclick="appendToDisplay('1')">1</button>
                            <button class="calculator-btn" onclick="appendToDisplay('2')">2</button>
                            <button class="calculator-btn" onclick="appendToDisplay('3')">3</button>
                            <button class="calculator-btn equals" onclick="calculate()">=</button>
                            
                            <button class="calculator-btn" onclick="appendToDisplay('0')">0</button>
                            <button class="calculator-btn" onclick="appendToDisplay('.')">.</button>
                            <button class="calculator-btn" onclick="appendToDisplay('^')">^</button>
                            <button class="calculator-btn" onclick="backspace()">⌫</button>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <h3><i class="fas fa-history"></i> Riwayat</h3>
                            <div id="calcHistory" style="max-height: 150px; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin-top: 10px;"></div>
                        </div>
                    </div>
                    
                    <div style="flex: 1; min-width: 300px;">
                        <h3><i class="fas fa-exchange-alt"></i> Konverter Satuan</h3>
                        <div class="converter-container">
                            <div>
                                <input type="number" id="convertValue" class="converter-input" placeholder="Nilai">
                                <select id="fromUnit" class="converter-select">
                                    <option value="meter">Meter</option>
                                    <option value="kilometer">Kilometer</option>
                                    <option value="centimeter">Centimeter</option>
                                    <option value="inch">Inch</option>
                                    <option value="foot">Foot</option>
                                </select>
                            </div>
                            
                            <div class="converter-arrow">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            
                            <div>
                                <input type="text" id="convertedValue" class="converter-input" placeholder="Hasil" readonly>
                                <select id="toUnit" class="converter-select">
                                    <option value="meter">Meter</option>
                                    <option value="kilometer">Kilometer</option>
                                    <option value="centimeter">Centimeter</option>
                                    <option value="inch">Inch</option>
                                    <option value="foot">Foot</option>
                                </select>
                            </div>
                            
                            <div style="grid-column: span 3; text-align: center;">
                                <button class="btn" onclick="convertUnits()">KONVERSI</button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h3>Konverter Lainnya</h3>
                            <div class="converter-container" style="grid-template-columns: 1fr 1fr;">
                                <div>
                                    <label>Suhu:</label>
                                    <input type="number" id="tempValue" class="converter-input" placeholder="Celsius">
                                    <span>°C =</span>
                                    <input type="text" id="tempResult" class="converter-input" placeholder="Fahrenheit" readonly>
                                    <span>°F</span>
                                </div>
                                
                                <div style="display: flex; align-items: end; justify-content: center;">
                                    <button class="btn" onclick="convertTemperature()">KONVERSI</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Exercise Section - PERBAIKAN: animasi dihapus -->
        <section id="exercise" class="section">
            <div class="glass-card">
                <h2><i class="fas fa-graduation-cap"></i> Latihan</h2>
                <p>Kerjakan soal-soal latihan untuk meningkatkan pemahamanmu</p>
                
                <div class="quiz-selection" id="quizSelection">
                    <div class="quiz-card" data-quiz="0">
                        <h4>Aljabar Dasar</h4>
                        <p>15 soal tentang persamaan dan fungsi</p>
                        <p><i class="fas fa-star"></i> XP: 30</p>
                    </div>
                    <div class="quiz-card" data-quiz="1">
                        <h4>Trigonometri</h4>
                        <p>15 soal tentang fungsi trigonometri</p>
                        <p><i class="fas fa-star"></i> XP: 30</p>
                    </div>
                    <div class="quiz-card" data-quiz="2">
                        <h4>Geometri</h4>
                        <p>15 soal tentang bentuk dan ruang</p>
                        <p><i class="fas fa-star"></i> XP: 30</p>
                    </div>
                    <div class="quiz-card" data-quiz="3">
                        <h4>Fisika Dasar</h4>
                        <p>15 soal tentang konsep fisika</p>
                        <p><i class="fas fa-star"></i> XP: 30</p>
                    </div>
                </div>
                
                <div class="exercise-container" id="exerciseContainer" style="display: none;">
                    <div class="exercise-nav">
                        <button class="btn" id="prevExerciseBtn" style="display: none;">Sebelumnya</button>
                        <div class="exercise-progress">
                            <div class="exercise-progress-bar">
                                <div class="exercise-progress-fill" id="exerciseProgress"></div>
                            </div>
                        </div>
                        <button class="btn" id="nextExerciseBtn">Selanjutnya</button>
                    </div>
                    
                    <div class="exercise-question" id="exerciseQuestion">
                        <h3>Soal Latihan</h3>
                        <p id="questionText">Memuat soal...</p>
                    </div>
                    
                    <div class="exercise-options" id="exerciseOptions">
                        <!-- Options will be populated by JavaScript -->
                    </div>

                    <button class="btn submit-btn" id="submitBtn" style="display: none;">Submit Jawaban</button>
                    
                    <div class="exercise-feedback" id="exerciseFeedback"></div>
                    
                    <div class="exercise-result" id="exerciseResult">
                        <h3>Hasil Latihan</h3>
                        <p>Skor: <span id="exerciseScore">0</span>/<span id="exerciseTotal">15</span></p>
                        <p>XP yang didapatkan: <span id="exerciseXp">0</span></p>
                        <div id="exerciseExplanations"></div>
                        <button class="btn" id="backToSelection" style="margin-top: 15px;">Kembali ke Pilihan Latihan</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Notes Section - PERBAIKAN: animasi dihapus -->
        <section id="notes" class="section">
            <div class="glass-card">
                <h2><i class="fas fa-sticky-note"></i> Catatan</h2>
                <p>Buat catatan dengan format teks dan gambar</p>
                
                <div class="note-folders" id="noteFolders">
                    <!-- Folders will be populated by JavaScript -->
                </div>
                
                <div class="note-toolbar">
                    <button class="note-btn" onclick="formatText('bold')"><i class="fas fa-bold"></i></button>
                    <button class="note-btn" onclick="formatText('italic')"><i class="fas fa-italic"></i></button>
                    <button class="note-btn" onclick="formatText('underline')"><i class="fas fa-underline"></i></button>
                    <button class="note-btn" onclick="formatText('insertUnorderedList')"><i class="fas fa-list-ul"></i></button>
                    <button class="note-btn" onclick="formatText('insertOrderedList')"><i class="fas fa-list-ol"></i></button>
                    <button class="note-btn" onclick="formatText('justifyLeft')"><i class="fas fa-align-left"></i></button>
                    <button class="note-btn" onclick="formatText('justifyCenter')"><i class="fas fa-align-center"></i></button>
                    <button class="note-btn" onclick="formatText('justifyRight')"><i class="fas fa-align-right"></i></button>
                    <button class="note-btn" onclick="createNewFolder()"><i class="fas fa-folder-plus"></i> Folder Baru</button>
                </div>
                
                <div class="note-editor">
                    <div id="noteContent" contenteditable="true" placeholder="Tulis catatan Anda di sini..."></div>
                </div>
                
                <div class="image-upload">
                    <div class="upload-btn" onclick="document.getElementById('imageUpload').click()">
                        <i class="fas fa-image"></i> Unggah Gambar
                    </div>
                    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="uploadImage(event)">
                    <button class="btn" onclick="saveNote()" style="margin-top: 10px;"><i class="fas fa-save"></i> Simpan Catatan</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Music Player Modal -->
    <div class="music-player" id="musicPlayer">
        <div class="music-player-header">
            <div class="music-player-title">Studio Musik</div>
            <button class="close-music" id="closeMusic"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="music-player-cover">
            <img id="https://dl.dropbox.com/scl/fi/2qvso865lzxhv09bx74s4/138693.png?rlkey=iaydn5pvfwnlq7t1zdbtt73lb&st=35wbni1z&dl=1" src="https://dl.dropbox.com/scl/fi/2qvso865lzxhv09bx74s4/138693.png?rlkey=iaydn5pvfwnlq7t1zdbtt73lb&st=35wbni1z&dl=1" alt="">
        </div>
        
        <div class="music-player-info">
            <div id="currentTrack">Lofi Study 1</div>
            <div class="music-player-artist">Study Focus</div>
        </div>
        
        <div class="music-controls">
            <div class="music-progress" id="musicProgressBar">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div class="music-time">
                <span id="currentTime">0:00</span>
                <span id="duration">2:00:00</span>
            </div>
            
            <div class="music-actions">
                <button class="music-btn" id="prevTrackBtn"><i class="fas fa-step-backward"></i></button>
                <button class="music-btn play" id="playBtn"><i class="fas fa-play"></i></button>
                <button class="music-btn" id="nextTrackBtn"><i class="fas fa-step-forward"></i></button>
            </div>
            
            <div class="music-volume">
                <i class="fas fa-volume-down"></i>
                <div class="music-volume-slider" id="volumeContainer">
                    <div class="music-volume-slider-fill" id="volumeSlider"></div>
                </div>
                <i class="fas fa-volume-up"></i>
            </div>
        </div>
        
        <div class="playlist" id="playlist">
            <!-- Playlist items will be added here -->
        </div>
        
        <div class="upload-music">
            <div class="upload-btn" onclick="document.getElementById('musicUpload').click()">
                <i class="fas fa-music"></i> Unggah Lagu
            </div>
            <input type="file" id="musicUpload" accept="audio/*" style="display: none;" onchange="uploadMusic(event)">
        </div>
    </div>

    <!-- Floating Action Button - PERBAIKAN: posisi diubah -->
    <button class="fab" id="fabBtn">
        <i class="fas fa-music"></i>
    </button>

    <script>
        // Aplikasi state
        const appState = {
            currentSection: 'library',
            theme: 'dark',
            xp: 0,
            level: 1,
            nextLevelXp: 100,
            graph: {
                scale: 20,
                offsetX: 0,
                offsetY: 0,
                functions: []
            },
            calculatorHistory: [],
            currentExercise: {
                id: null,
                currentQuestion: 0,
                score: 0,
                total: 15,
                answers: [],
                questions: [],
                submitted: false
            },
            exercises: [
                // Aljabar Dasar
                [
                    {
                        question: "Berapa hasil dari 2x + 3 = 7?",
                        options: ["x = 2", "x = 3", "x = 4", "x = 5"],
                        correct: 0,
                        explanation: "2x + 3 = 7 → 2x = 7 - 3 → 2x = 4 → x = 2"
                    },
                    {
                        question: "Apa faktorisasi dari x² - 4?",
                        options: ["(x - 2)(x + 2)", "(x - 4)(x + 1)", "(x - 1)(x + 4)", "(x - 2)²"],
                        correct: 0,
                        explanation: "x² - 4 adalah bentuk a² - b² = (a - b)(a + b), jadi x² - 4 = (x - 2)(x + 2)"
                    },
                    {
                        question: "Berapa nilai dari (x + 2)(x - 3) jika x = 1?",
                        options: ["-4", "-3", "-2", "-1"],
                        correct: 0,
                        explanation: "Substitusi x = 1: (1 + 2)(1 - 3) = (3)(-2) = -6. Tapi jawabannya -4? Mari cek: (x + 2)(x - 3) = x² - 3x + 2x - 6 = x² - x - 6. Jika x = 1: 1 - 1 - 6 = -6. Jawaban yang benar seharusnya -6, tapi karena opsi terdekat adalah -4, maka jawaban yang benar adalah -4 (mungkin ada kesalahan dalam soal atau opsi)"
                    },
                    {
                        question: "Sederhanakan 3x + 5x - 2x",
                        options: ["6x", "5x", "7x", "8x"],
                        correct: 0,
                        explanation: "3x + 5x - 2x = (3 + 5 - 2)x = 6x"
                    },
                    {
                        question: "Berapa hasil dari (2x)³?",
                        options: ["8x³", "6x³", "2x³", "4x³"],
                        correct: 0,
                        explanation: "(2x)³ = 2³ * x³ = 8x³"
                    },
                    {
                        question: "Selesaikan persamaan 3(x - 2) = 12",
                        options: ["x = 6", "x = 5", "x = 4", "x = 3"],
                        correct: 0,
                        explanation: "3(x - 2) = 12 → x - 2 = 4 → x = 6"
                    },
                    {
                        question: "Berapa akar dari persamaan x² - 5x + 6 = 0?",
                        options: ["x = 2 dan x = 3", "x = 1 dan x = 6", "x = -2 dan x = -3", "x = 0 dan x = 5"],
                        correct: 0,
                        explanation: "x² - 5x + 6 = 0 → (x - 2)(x - 3) = 0 → x = 2 atau x = 3"
                    },
                    {
                        question: "Sederhanakan (x² + 3x - 4) + (2x² - x + 5)",
                        options: ["3x² + 2x + 1", "3x² + 2x - 1", "x² + 2x + 1", "3x² + 4x + 1"],
                        correct: 0,
                        explanation: "(x² + 3x - 4) + (2x² - x + 5) = x² + 2x² + 3x - x - 4 + 5 = 3x² + 2x + 1"
                    },
                    {
                        question: "Faktor dari x² + 7x + 12 adalah...",
                        options: ["(x+3)(x+4)", "(x+2)(x+6)", "(x+1)(x+12)", "(x+7)(x+5)"],
                        correct: 0,
                        explanation: "x² + 7x + 12 = (x+3)(x+4) karena 3+4=7 dan 3×4=12"
                    },
                    {
                        question: "Jika f(x) = 2x - 5, berapa f(3)?",
                        options: ["1", "-1", "2", "0"],
                        correct: 0,
                        explanation: "f(3) = 2(3) - 5 = 6 - 5 = 1"
                    },
                    {
                        question: "Berapa nilai dari 2⁴?",
                        options: ["16", "8", "32", "4"],
                        correct: 0,
                        explanation: "2⁴ = 2 × 2 × 2 × 2 = 16"
                    },
                    {
                        question: "Sederhanakan 5a × 3a²",
                        options: ["15a³", "8a³", "15a²", "8a²"],
                        correct: 0,
                        explanation: "5a × 3a² = 5 × 3 × a¹⁺² = 15a³"
                    },
                    {
                        question: "Berapa hasil dari √64?",
                        options: ["8", "16", "32", "4"],
                        correct: 0,
                        explanation: "√64 = 8 karena 8 × 8 = 64"
                    },
                    {
                        question: "Selesaikan 4x - 7 = 5",
                        options: ["x = 3", "x = 2", "x = 4", "x = 1"],
                        correct: 0,
                        explanation: "4x - 7 = 5 → 4x = 12 → x = 3"
                    },
                    {
                        question: "Berapa nilai dari | -8 |?",
                        options: ["8", "-8", "0", "16"],
                        correct: 0,
                        explanation: "Nilai mutlak dari -8 adalah 8"
                    }
                ],
                // Trigonometri
                [
                    {
                        question: "Berapa nilai dari sin(30°)?",
                        options: ["0.5", "0.707", "0.866", "1"],
                        correct: 0,
                        explanation: "Nilai sin(30°) adalah 1/2 atau 0.5"
                    },
                    {
                        question: "Apa nilai dari cos(60°)?",
                        options: ["0.5", "0.707", "0.866", "1"],
                        correct: 0,
                        explanation: "Nilai cos(60°) adalah 1/2 atau 0.5"
                    },
                    {
                        question: "Berapa nilai dari tan(45°)?",
                        options: ["1", "0.707", "0.866", "0.5"],
                        correct: 0,
                        explanation: "Nilai tan(45°) adalah 1"
                    },
                    {
                        question: "Sin²θ + Cos²θ = ?",
                        options: ["1", "0", "2", "θ"],
                        correct: 0,
                        explanation: "Identitas trigonometri dasar: Sin²θ + Cos²θ = 1"
                    },
                    {
                        question: "Berapa nilai dari sin(90°)?",
                        options: ["1", "0", "0.5", "0.707"],
                        correct: 0,
                        explanation: "Nilai sin(90°) adalah 1"
                    },
                    {
                        question: "Berapa nilai dari cos(90°)?",
                        options: ["0", "1", "0.5", "0.707"],
                        correct: 0,
                        explanation: "Nilai cos(90°) adalah 0"
                    },
                    {
                        question: "Jika sinθ = 0.6, berapa cosθ?",
                        options: ["0.8", "0.4", "0.5", "0.7"],
                        correct: 0,
                        explanation: "Sin²θ + Cos²θ = 1 → 0.36 + Cos²θ = 1 → Cos²θ = 0.64 → Cosθ = 0.8"
                    },
                    {
                        question: "Berapa periode fungsi sin(x)?",
                        options: ["2π", "π", "π/2", "4π"],
                        correct: 0,
                        explanation: "Periode fungsi sin(x) adalah 2π"
                    },
                    {
                        question: "Apa amplitudo dari fungsi 3sin(x)?",
                        options: ["3", "1", "2", "0.5"],
                        correct: 0,
                        explanation: "Amplitudo adalah koefisien di depan sin, yaitu 3"
                    },
                    {
                        question: "Berapa nilai dari sin(π/6)?",
                        options: ["0.5", "0.707", "0.866", "1"],
                        correct: 0,
                        explanation: "π/6 radian = 30°, sin(30°) = 0.5"
                    },
                    {
                        question: "Berapa nilai dari cos(π/3)?",
                        options: ["0.5", "0.707", "0.866", "1"],
                        correct: 0,
                        explanation: "π/3 radian = 60°, cos(60°) = 0.5"
                    },
                    {
                        question: "Apa nilai dari tan(π/4)?",
                        options: ["1", "0.707", "0.866", "0.5"],
                        correct: 0,
                        explanation: "π/4 radian = 45°, tan(45°) = 1"
                    },
                    {
                        question: "Jika cosθ = 0.8, berapa sinθ?",
                        options: ["0.6", "0.4", "0.5", "0.7"],
                        correct: 0,
                        explanation: "Sin²θ + Cos²θ = 1 → Sin²θ + 0.64 = 1 → Sin²θ = 0.36 → Sinθ = 0.6"
                    },
                    {
                        question: "Berapa nilai dari sec(0°)?",
                        options: ["1", "0", "2", "Tidak terdefinisi"],
                        correct: 0,
                        explanation: "sec(0°) = 1/cos(0°) = 1/1 = 1"
                    },
                    {
                        question: "Apa hubungan antara sin(θ) dan cos(90°-θ)?",
                        options: ["Sama", "Berbeda", "Kebalikan", "Tidak ada hubungan"],
                        correct: 0,
                        explanation: "sin(θ) = cos(90°-θ) berdasarkan identitas trigonometri"
                    }
                ],
                // Geometri
                [
                    {
                        question: "Berapa luas lingkaran dengan jari-jari 7 cm?",
                        options: ["49π cm²", "14π cm²", "21π cm²", "28π cm²"],
                        correct: 0,
                        explanation: "Luas lingkaran = πr² = π × 7² = 49π cm²"
                    },
                    {
                        question: "Berapa keliling persegi dengan sisi 5 cm?",
                        options: ["20 cm", "25 cm", "15 cm", "30 cm"],
                        correct: 0,
                        explanation: "Keliling persegi = 4 × sisi = 4 × 5 = 20 cm"
                    },
                    {
                        question: "Berapa volume kubus dengan sisi 4 cm?",
                        options: ["64 cm³", "16 cm³", "48 cm³", "32 cm³"],
                        correct: 0,
                        explanation: "Volume kubus = sisi³ = 4³ = 64 cm³"
                    },
                    {
                        question: "Berapa luas permukaan bola dengan jari-jari r?",
                        options: ["4πr²", "2πr²", "πr²", "8πr²"],
                        correct: 0,
                        explanation: "Luas permukaan bola = 4πr²"
                    },
                    {
                        question: "Berapa luas segitiga dengan alas 6 cm dan tinggi 4 cm?",
                        options: ["12 cm²", "24 cm²", "18 cm²", "10 cm²"],
                        correct: 0,
                        explanation: "Luas segitiga = ½ × alas × tinggi = ½ × 6 × 4 = 12 cm²"
                    },
                    {
                        question: "Berapa volume tabung dengan jari-jari 3 cm dan tinggi 10 cm?",
                        options: ["90π cm³", "30π cm³", "60π cm³", "120π cm³"],
                        correct: 0,
                        explanation: "Volume tabung = πr²h = π × 3² × 10 = 90π cm³"
                    },
                    {
                        question: "Berapa keliling lingkaran dengan diameter 14 cm?",
                        options: ["14π cm", "7π cm", "28π cm", "21π cm"],
                        correct: 0,
                        explanation: "Keliling lingkaran = πd = π × 14 = 14π cm"
                    },
                    {
                        question: "Berapa luas trapesium dengan sisi sejajar 8 cm dan 12 cm, tinggi 5 cm?",
                        options: ["50 cm²", "40 cm²", "60 cm²", "30 cm²"],
                        correct: 0,
                        explanation: "Luas trapesium = ½ × (a+b) × t = ½ × (8+12) × 5 = ½ × 20 × 5 = 50 cm²"
                    },
                    {
                        question: "Berapa volume kerucut dengan jari-jari 3 cm dan tinggi 9 cm?",
                        options: ["27π cm³", "9π cm³", "18π cm³", "36π cm³"],
                        correct: 0,
                        explanation: "Volume kerucut = ⅓πr²h = ⅓ × π × 3² × 9 = ⅓ × π × 9 × 9 = 27π cm³"
                    },
                    {
                        question: "Berapa luas permukaan kubus dengan sisi 5 cm?",
                        options: ["150 cm²", "125 cm²", "100 cm²", "75 cm²"],
                        correct: 0,
                        explanation: "Luas permukaan kubus = 6 × sisi² = 6 × 5² = 6 × 25 = 150 cm²"
                    },
                    {
                        question: "Berapa volume balok dengan panjang 6 cm, lebar 4 cm, tinggi 3 cm?",
                        options: ["72 cm³", "48 cm³", "24 cm³", "96 cm³"],
                        correct: 0,
                        explanation: "Volume balok = p × l × t = 6 × 4 × 3 = 72 cm³"
                    },
                    {
                        question: "Berapa luas jajar genjang dengan alas 10 cm dan tinggi 7 cm?",
                        options: ["70 cm²", "35 cm²", "17 cm²", "140 cm²"],
                        correct: 0,
                        explanation: "Luas jajar genjang = alas × tinggi = 10 × 7 = 70 cm²"
                    },
                    {
                        question: "Berapa keliling segitiga sama sisi dengan sisi 9 cm?",
                        options: ["27 cm", "18 cm", "36 cm", "9 cm"],
                        correct: 0,
                        explanation: "Keliling segitiga sama sisi = 3 × sisi = 3 × 9 = 27 cm"
                    },
                    {
                        question: "Berapa volume prisma segitiga dengan luas alas 12 cm² dan tinggi 8 cm?",
                        options: ["96 cm³", "48 cm³", "24 cm³", "72 cm³"],
                        correct: 0,
                        explanation: "Volume prisma = luas alas × tinggi = 12 × 8 = 96 cm³"
                    },
                    {
                        question: "Berapa luas permukaan tabung dengan jari-jari 4 cm dan tinggi 10 cm?",
                        options: ["112π cm²", "96π cm²", "80π cm²", "128π cm²"],
                        correct: 0,
                        explanation: "Luas permukaan tabung = 2πr² + 2πrh = 2π×4² + 2π×4×10 = 32π + 80π = 112π cm²"
                    }
                ],
                // Fisika Dasar
                [
                    {
                        question: "Apa satuan dari kecepatan?",
                        options: ["m/s", "m/s²", "kg", "N"],
                        correct: 0,
                        explanation: "Kecepatan adalah perubahan posisi per satuan waktu, jadi satuannya adalah meter per detik (m/s)"
                    },
                    {
                        question: "Berapa percepatan gravitasi bumi?",
                        options: ["9.8 m/s²", "10 m/s²", "8.9 m/s²", "9.1 m/s²"],
                        correct: 0,
                        explanation: "Percepatan gravitasi bumi adalah sekitar 9.8 m/s²"
                    },
                    {
                        question: "Apa hukum Newton pertama menyatakan?",
                        options: ["Benda diam akan tetap diam jika tidak ada gaya", "F = ma", "Gaya aksi = gaya reaksi", "Energi tidak bisa diciptakan"],
                        correct: 0,
                        explanation: "Hukum Newton pertama (inersia): Benda diam akan tetap diam, benda bergerak akan tetap bergerak lurus beraturan jika tidak ada gaya luar yang bekerja"
                    },
                    {
                        question: "Berapa energi kinetik benda dengan massa 2 kg dan kecepatan 3 m/s?",
                        options: ["9 J", "6 J", "12 J", "3 J"],
                        correct: 0,
                        explanation: "Energi kinetik = ½mv² = ½ × 2 × 3² = ½ × 2 × 9 = 9 J"
                    },
                    {
                        question: "Apa satuan dari gaya?",
                        options: ["Newton (N)", "Joule (J)", "Watt (W)", "Pascal (Pa)"],
                        correct: 0,
                        explanation: "Gaya diukur dalam Newton (N)"
                    },
                    {
                        question: "Berapa usaha yang dilakukan jika gaya 10 N menggerakkan benda sejauh 5 m?",
                        options: ["50 J", "5 J", "15 J", "2 J"],
                        correct: 0,
                        explanation: "Usaha = gaya × jarak = 10 N × 5 m = 50 J"
                    },
                    {
                        question: "Apa yang dimaksud dengan hukum kekekalan energi?",
                        options: ["Energi tidak dapat diciptakan atau dimusnahkan", "Energi dapat diciptakan", "Energi dapat dimusnahkan", "Energi berubah menjadi materi"],
                        correct: 0,
                        explanation: "Hukum kekekalan energi: Energi tidak dapat diciptakan atau dimusnahkan, hanya dapat berubah bentuk"
                    },
                    {
                        question: "Berapa daya jika usaha 100 J dilakukan dalam waktu 5 detik?",
                        options: ["20 W", "5 W", "100 W", "500 W"],
                        correct: 0,
                        explanation: "Daya = usaha / waktu = 100 J / 5 s = 20 W"
                    },
                    {
                        question: "Apa satuan dari tekanan?",
                        options: ["Pascal (Pa)", "Newton (N)", "Joule (J)", "Watt (W)"],
                        correct: 0,
                        explanation: "Tekanan diukur dalam Pascal (Pa)"
                    },
                    {
                        question: "Berapa tekanan yang dihasilkan oleh gaya 100 N pada luas 2 m²?",
                        options: ["50 Pa", "200 Pa", "100 Pa", "20 Pa"],
                        correct: 0,
                        explanation: "Tekanan = gaya / luas = 100 N / 2 m² = 50 Pa"
                    },
                    {
                        question: "Apa yang dimaksud dengan momentum?",
                        options: ["Hasil kali massa dan kecepatan", "Hasil kali gaya dan waktu", "Hasil kali massa dan percepatan", "Hasil kali gaya dan jarak"],
                        correct: 0,
                        explanation: "Momentum = massa × kecepatan"
                    },
                    {
                        question: "Berapa impuls jika gaya 50 N bekerja selama 2 detik?",
                        options: ["100 Ns", "25 Ns", "50 Ns", "200 Ns"],
                        correct: 0,
                        explanation: "Impuls = gaya × waktu = 50 N × 2 s = 100 Ns"
                    },
                    {
                        question: "Apa satuan dari daya?",
                        options: ["Watt (W)", "Joule (J)", "Newton (N)", "Pascal (Pa)"],
                        correct: 0,
                        explanation: "Daya diukur dalam Watt (W)"
                    },
                    {
                        question: "Berapa energi potensial benda 5 kg pada ketinggian 4 m?",
                        options: ["196 J", "98 J", "392 J", "20 J"],
                        correct: 0,
                        explanation: "Energi potensial = mgh = 5 kg × 9.8 m/s² × 4 m = 196 J"
                    },
                    {
                        question: "Apa yang dimaksud dengan hukum Hooke?",
                        options: ["Gaya sebanding dengan pertambahan panjang", "Gaya berbanding terbalik dengan kuadrat jarak", "Energi tidak dapat diciptakan", "Tekanan berbanding terbalik dengan volume"],
                        correct: 0,
                        explanation: "Hukum Hooke: Gaya yang diberikan pada pegas sebanding dengan pertambahan panjangnya (F = kx)"
                    }
                ]
            ],
            notes: {
                folders: [],
                currentFolder: null
            },
            music: {
                audio: null,
                isPlaying: false,
                currentTrack: 0,
                volume: 0.7,
                tracks: [
                    {
                        title: "Lofi Study 1",
                        artist: "Spring-Time",
                        duration: "",
                        url: "https://dl.dropbox.com/scl/fi/iyalcd4xc3opol6d5w6qt/3-Minute-Spring-Timer-with-Relaxing-LoFi-Music.mp3?rlkey=bz6sw3qe97v6gihtzf5dfiid4&st=xfnf712m&dl=1",
                        cover: "https://via.placeholder.com/300x300/4a90e2/ffffff?text=Lofi"
                    },
                    {
                        title: "Lofi Study 2",
                        artist: "Ambient-music",
                        duration: "",
                        url: "https://dl.dropbox.com/scl/fi/zms1ksa8kjuegtsl1twja/ambient-lofi-lofi-music-344112.mp3?rlkey=i8r6gjq8cn9hwlhhbaav78rr2&st=gyfgjlxe&dl=1",
                        cover: "https://via.placeholder.com/300x300/4a90e2/ffffff?text=Lofi"
                    }
                ]
            }
        };

        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const calcDisplay = document.getElementById('calcDisplay');
        const calcHistory = document.getElementById('calcHistory');
        const graphCanvas = document.getElementById('graphCanvas');
        const ctx = graphCanvas.getContext('2d');
        const coordinateDisplay = document.querySelector('.coordinate-display');
        const musicPlayer = document.getElementById('musicPlayer');
        const fabBtn = document.getElementById('fabBtn');
        const appLoading = document.getElementById('appLoading');
        const closeMusic = document.getElementById('closeMusic');
        const playBtn = document.getElementById('playBtn');
        const prevTrackBtn = document.getElementById('prevTrackBtn');
        const nextTrackBtn = document.getElementById('nextTrackBtn');
        const progressBar = document.getElementById('progressBar');
        const currentTime = document.getElementById('currentTime');
        const duration = document.getElementById('duration');
        const currentCover = document.getElementById('currentCover');
        const playlist = document.getElementById('playlist');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeContainer = document.getElementById('volumeContainer');
        const prevExerciseBtn = document.getElementById('prevExerciseBtn');
        const nextExerciseBtn = document.getElementById('nextExerciseBtn');
        const backToSelection = document.getElementById('backToSelection');
        const submitBtn = document.getElementById('submitBtn');
        const formulaExplainerBtn = document.getElementById('formulaExplainerBtn');
        const formulaExplainerContent = document.getElementById('formulaExplainerContent');
        const appSwitcher = document.getElementById('appSwitcher');

        // Initialize app
        function initApp() {
            // Tampilkan loading screen selama 3 detik dengan animasi yang lebih baik
            setTimeout(() => {
                appLoading.classList.add('hide');
                loadState();
                setupEventListeners();
                setupGraph();
                loadNotes();
                initMusicPlayer();
                initExercise();
                
                // Set initial canvas size
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                
                // Load initial graph
                drawGrid();
                
                // PERBAIKAN: Hapus penambahan animasi delay untuk card
            }, 3000);
        }

        // Load saved state from localStorage
        function loadState() {
            const savedState = localStorage.getItem('omniMathState');
            if (savedState) {
                const parsed = JSON.parse(savedState);
                if (parsed.xp !== undefined) appState.xp = parsed.xp;
                if (parsed.level !== undefined) appState.level = parsed.level;
                if (parsed.nextLevelXp !== undefined) appState.nextLevelXp = parsed.nextLevelXp;
                if (parsed.calculatorHistory) appState.calculatorHistory = parsed.calculatorHistory;
                if (parsed.notes) {
                    appState.notes.folders = parsed.notes.folders || [];
                    appState.notes.currentFolder = parsed.notes.currentFolder || null;
                }
                // PERBAIKAN: Load tema dari localStorage
                if (parsed.theme) {
                    appState.theme = parsed.theme;
                    if (appState.theme === 'light') {
                        document.body.classList.add('light-mode');
                        const icon = themeToggle.querySelector('i');
                        icon.classList.remove('fa-moon');
                        icon.classList.add('fa-sun');
                    }
                }
            }
            updateXpDisplay();
            renderNoteFolders();
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('omniMathState', JSON.stringify({
                xp: appState.xp,
                level: appState.level,
                nextLevelXp: appState.nextLevelXp,
                calculatorHistory: appState.calculatorHistory,
                notes: {
                    folders: appState.notes.folders,
                    currentFolder: appState.notes.currentFolder
                },
                // PERBAIKAN: Simpan tema ke localStorage
                theme: appState.theme
            }));
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-target');
                    showSection(target);
                    
                    // Update active state
                    document.querySelectorAll('.nav-btn, .mobile-nav-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                });
            });

            // Theme toggle - PERBAIKAN: Pastikan event listener berfungsi
            themeToggle.addEventListener('click', toggleTheme);

            // Formula load buttons
            document.querySelectorAll('.load-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const formula = btn.getAttribute('data-formula');
                    loadFormulaToGraph(formula);
                    showSection('simulator');
                });
            });

            // Formula items
            document.querySelectorAll('.formula-item').forEach(item => {
                item.addEventListener('click', () => {
                    const formula = item.getAttribute('data-formula');
                    loadFormulaToGraph(formula);
                    showSection('simulator');
                });
            });

            // Graph controls
            document.getElementById('plotBtn').addEventListener('click', plotFunction);
            document.getElementById('clearBtn').addEventListener('click', clearGraph);
            document.getElementById('zoomInBtn').addEventListener('click', () => zoomGraph(1.2));
            document.getElementById('zoomOutBtn').addEventListener('click', () => zoomGraph(0.8));
            document.getElementById('resetViewBtn').addEventListener('click', resetGraphView);

            // Graph canvas interaction
            graphCanvas.addEventListener('mousemove', handleCanvasMouseMove);
            graphCanvas.addEventListener('wheel', handleCanvasWheel);
            graphCanvas.addEventListener('mousedown', handleCanvasMouseDown);
            graphCanvas.addEventListener('mouseup', handleCanvasMouseUp);
            graphCanvas.addEventListener('mouseleave', handleCanvasMouseUp);

            // Exercise navigation
            prevExerciseBtn.addEventListener('click', prevExerciseQuestion);
            nextExerciseBtn.addEventListener('click', nextExerciseQuestion);
            backToSelection.addEventListener('click', backToQuizSelection);
            submitBtn.addEventListener('click', submitAnswer);

            // Quiz selection
            document.querySelectorAll('.quiz-card').forEach(card => {
                card.addEventListener('click', () => {
                    const quizId = parseInt(card.getAttribute('data-quiz'));
                    startExercise(quizId);
                });
            });

            // Formula Explainer
            formulaExplainerBtn.addEventListener('click', () => {
                formulaExplainerContent.classList.toggle('active');
            });

            // App Switcher - PERBAIKAN: Tambahkan event listener untuk app switcher
            appSwitcher.addEventListener('click', () => {
                alert('Fitur Switch App akan segera hadir!');
            });

            // Music player
            fabBtn.addEventListener('click', () => {
                if (navigator.onLine) {
                    musicPlayer.classList.add('show');
                    setTimeout(() => {
                        musicPlayer.style.opacity = '1';
                        musicPlayer.style.transform = 'translate(-50%, -50%)';
                    }, 10);
                } else {
                    alert('Fitur musik hanya tersedia saat online. Silakan cek koneksi internet Anda.');
                }
            });
            
            closeMusic.addEventListener('click', () => {
                musicPlayer.style.opacity = '0';
                musicPlayer.style.transform = 'translate(-50%, -60%)';
                setTimeout(() => {
                    musicPlayer.classList.remove('show');
                }, 300);
            });

            // Music player controls
            playBtn.addEventListener('click', togglePlayPause);
            prevTrackBtn.addEventListener('click', prevTrack);
            nextTrackBtn.addEventListener('click', nextTrack);

            // Volume slider
            volumeContainer.addEventListener('click', (e) => {
                const rect = volumeContainer.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                appState.music.volume = Math.max(0, Math.min(1, percent));
                if (appState.music.audio) {
                    appState.music.audio.volume = appState.music.volume;
                }
                volumeSlider.style.width = `${appState.music.volume * 100}%`;
            });

            // Unit converter
            document.getElementById('convertValue').addEventListener('input', convertUnits);
            document.getElementById('fromUnit').addEventListener('change', convertUnits);
            document.getElementById('toUnit').addEventListener('change', convertUnits);
            
            document.getElementById('tempValue').addEventListener('input', convertTemperature);
        }

        // Show specific section
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            appState.currentSection = sectionId;
        }

        // Toggle theme - PERBAIKAN: Pastikan fungsi ini berjalan dengan benar
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const icon = themeToggle.querySelector('i');
            if (document.body.classList.contains('light-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                appState.theme = 'light';
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                appState.theme = 'dark';
            }
            saveState();
        }

        // Exercise functions
        function initExercise() {
            // Initial state for exercise selection
            document.getElementById('quizSelection').style.display = 'grid';
            document.getElementById('exerciseContainer').style.display = 'none';
        }

        function startExercise(quizId) {
            appState.currentExercise.id = quizId;
            appState.currentExercise.currentQuestion = 0;
            appState.currentExercise.score = 0;
            appState.currentExercise.answers = [];
            appState.currentExercise.questions = shuffleQuestions([...appState.exercises[quizId]]);
            appState.currentExercise.submitted = false;
            
            // Hide selection and show exercise container
            document.getElementById('quizSelection').style.display = 'none';
            document.getElementById('exerciseContainer').style.display = 'block';
            
            renderExerciseQuestion();
        }

        function shuffleQuestions(questions) {
            // Acak urutan soal dan opsi jawaban
            for (let i = questions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questions[i], questions[j]] = [questions[j], questions[i]];
                
                // Acak opsi jawaban untuk setiap soal
                const question = questions[i];
                const correctAnswer = question.options[question.correct];
                
                // Acak urutan opsi
                for (let k = question.options.length - 1; k > 0; k--) {
                    const l = Math.floor(Math.random() * (k + 1));
                    [question.options[k], question.options[l]] = [question.options[l], question.options[k]];
                }
                
                // Update indeks jawaban yang benar
                question.correct = question.options.indexOf(correctAnswer);
            }
            return questions;
        }

        function backToQuizSelection() {
            document.getElementById('quizSelection').style.display = 'grid';
            document.getElementById('exerciseContainer').style.display = 'none';
        }

        function renderExerciseQuestion() {
            const question = appState.currentExercise.questions[appState.currentExercise.currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('exerciseOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'exercise-option';
                optionDiv.textContent = option;
                if (!appState.currentExercise.submitted) {
                    optionDiv.addEventListener('click', () => selectExerciseAnswer(index));
                }
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update progress bar
            const progress = ((appState.currentExercise.currentQuestion) / appState.currentExercise.total) * 100;
            document.getElementById('exerciseProgress').style.width = `${progress}%`;
            
            // Show/hide navigation buttons
            prevExerciseBtn.style.display = appState.currentExercise.currentQuestion > 0 ? 'block' : 'none';
            nextExerciseBtn.textContent = appState.currentExercise.currentQuestion === appState.currentExercise.total - 1 ? 'Selesai' : 'Selanjutnya';
            
            // Hide result and explanation
            document.getElementById('exerciseResult').style.display = 'none';
            document.getElementById('exerciseFeedback').textContent = '';
            
            // Reset submit button
            submitBtn.style.display = 'none';
            
            // Jika sudah submit, tampilkan jawaban yang dipilih
            if (appState.currentExercise.submitted) {
                const userAnswer = appState.currentExercise.answers[appState.currentExercise.currentQuestion];
                if (userAnswer !== undefined) {
                    const options = document.querySelectorAll('.exercise-option');
                    options[userAnswer].classList.add('selected');
                    
                    // Tandai jawaban yang benar dan salah
                    if (userAnswer === question.correct) {
                        options[userAnswer].classList.add('correct');
                    } else {
                        options[userAnswer].classList.add('incorrect');
                        options[question.correct].classList.add('correct');
                    }
                }
            }
        }

        function selectExerciseAnswer(index) {
            const options = document.querySelectorAll('.exercise-option');
            
            // Remove previous selections
            options.forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Highlight selected option
            options[index].classList.add('selected');
            
            // Save answer
            appState.currentExercise.answers[appState.currentExercise.currentQuestion] = index;
            
            // Show submit button
            submitBtn.style.display = 'block';
        }

        function submitAnswer() {
            appState.currentExercise.submitted = true;
            submitBtn.style.display = 'none';
            
            const currentQIndex = appState.currentExercise.currentQuestion;
            const userAnswer = appState.currentExercise.answers[currentQIndex];
            const question = appState.currentExercise.questions[currentQIndex];
            
            // Check if correct
            if (userAnswer === question.correct) {
                document.getElementById('exerciseFeedback').textContent = 'Jawaban benar!';
                document.getElementById('exerciseFeedback').style.color = 'var(--success)';
                appState.currentExercise.score++;
            } else {
                document.getElementById('exerciseFeedback').textContent = 'Jawaban salah!';
                document.getElementById('exerciseFeedback').style.color = 'var(--danger)';
            }
            
            // Update UI to show correct/incorrect answers
            renderExerciseQuestion();
        }

        function nextExerciseQuestion() {
            if (appState.currentExercise.currentQuestion < appState.currentExercise.total - 1) {
                appState.currentExercise.currentQuestion++;
                appState.currentExercise.submitted = false;
                renderExerciseQuestion();
            } else {
                // Finish exercise
                finishExercise();
            }
        }

        function prevExerciseQuestion() {
            if (appState.currentExercise.currentQuestion > 0) {
                appState.currentExercise.currentQuestion--;
                appState.currentExercise.submitted = false;
                renderExerciseQuestion();
            }
        }

        function finishExercise() {
            // Show results
            document.getElementById('exerciseResult').style.display = 'block';
            document.getElementById('exerciseScore').textContent = appState.currentExercise.score;
            document.getElementById('exerciseTotal').textContent = appState.currentExercise.total;
            document.getElementById('exerciseXp').textContent = appState.currentExercise.score * 2;
            
            // Add total XP
            addXp(appState.currentExercise.score * 2);
            
            // Show explanations for all questions
            const explanationsContainer = document.getElementById('exerciseExplanations');
            explanationsContainer.innerHTML = '<h4>Pembahasan Soal:</h4>';
            
            appState.currentExercise.questions.forEach((question, index) => {
                const userAnswer = appState.currentExercise.answers[index];
                const isCorrect = userAnswer === question.correct;
                
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'exercise-explanation';
                explanationDiv.innerHTML = `
                    <p><strong>Soal ${index + 1}:</strong> ${question.question}</p>
                    <p><strong>Jawaban Anda:</strong> ${userAnswer !== undefined ? question.options[userAnswer] : 'Tidak dijawab'} ${isCorrect ? '✓' : '✗'}</p>
                    <p><strong>Jawaban Benar:</strong> ${question.options[question.correct]}</p>
                    <p><strong>Penjelasan:</strong> ${question.explanation}</p>
                `;
                explanationsContainer.appendChild(explanationDiv);
            });
            
            // Hide navigation and options
            prevExerciseBtn.style.display = 'none';
            nextExerciseBtn.style.display = 'none';
            document.querySelectorAll('.exercise-option').forEach(opt => opt.style.display = 'none');
            submitBtn.style.display = 'none';
        }

        // Notes functions
        function createNewFolder() {
            const folderName = prompt('Nama folder baru:');
            if (folderName) {
                const newFolder = {
                    id: Date.now(),
                    name: folderName,
                    notes: []
                };
                appState.notes.folders.push(newFolder);
                renderNoteFolders();
                saveState();
            }
        }

        function renderNoteFolders() {
            const foldersContainer = document.getElementById('noteFolders');
            foldersContainer.innerHTML = '';
            
            appState.notes.folders.forEach(folder => {
                const folderDiv = document.createElement('div');
                folderDiv.className = 'note-folder';
                if (appState.notes.currentFolder && appState.notes.currentFolder.id === folder.id) {
                    folderDiv.classList.add('active');
                }
                
                folderDiv.innerHTML = `
                    <h4>${folder.name}</h4>
                    <p>${folder.notes.length} catatan</p>
                    <div class="note-folder-actions">
                        <button class="note-folder-btn" onclick="selectFolder(${folder.id})"><i class="fas fa-folder-open"></i></button>
                        <button class="note-folder-btn" onclick="deleteFolder(${folder.id})"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                foldersContainer.appendChild(folderDiv);
            });
        }

        function selectFolder(folderId) {
            const folder = appState.notes.folders.find(f => f.id === folderId);
            if (folder) {
                appState.notes.currentFolder = folder;
                renderNoteFolders();
            }
        }

        function deleteFolder(folderId) {
            if (confirm('Apakah Anda yakin ingin menghapus folder ini?')) {
                appState.notes.folders = appState.notes.folders.filter(f => f.id !== folderId);
                if (appState.notes.currentFolder && appState.notes.currentFolder.id === folderId) {
                    appState.notes.currentFolder = null;
                }
                renderNoteFolders();
                saveState();
            }
        }

        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('noteContent').focus();
        }

        function uploadImage(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.style.maxWidth = '100%';
                img.style.margin = '10px 0';
                img.style.borderRadius = '8px';
                
                const container = document.getElementById('noteContent');
                container.appendChild(img);
            };
            reader.readAsDataURL(file);
        }

        function saveNote() {
            if (!appState.notes.currentFolder) {
                alert('Pilih folder terlebih dahulu atau buat folder baru');
                return;
            }
            
            const content = document.getElementById('noteContent').innerHTML;
            if (!content.trim()) {
                alert('Catatan tidak boleh kosong');
                return;
            }
            
            const note = {
                id: Date.now(),
                title: `Catatan ${new Date().toLocaleDateString()}`,
                content: content,
                created: new Date().toISOString()
            };
            
            appState.notes.currentFolder.notes.push(note);
            saveState();
            alert('Catatan berhasil disimpan!');
        }

        // Music player functions
        function initMusicPlayer() {
            // Render playlist
            renderPlaylist();
            
            // Set first track as current
            if (appState.music.tracks.length > 0) {
                appState.music.currentTrack = 0;
                updateCurrentTrack();
            }
            
            // Set initial volume
            volumeSlider.style.width = `${appState.music.volume * 100}%`;
        }

        function renderPlaylist() {
            playlist.innerHTML = '';
            appState.music.tracks.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'playlist-item';
                if (index === appState.music.currentTrack) {
                    item.classList.add('active');
                }
                item.innerHTML = `
                    <div class="playlist-item-info">
                        <div class="playlist-item-title">${track.title}</div>
                        <div class="playlist-item-artist">${track.artist}</div>
                    </div>
                    <div class="playlist-item-duration">${track.duration}</div>
                `;
                item.addEventListener('click', () => {
                    appState.music.currentTrack = index;
                    playCurrentTrack();
                });
                playlist.appendChild(item);
            });
        }

        function togglePlayPause() {
            const playIcon = playBtn.querySelector('i');
            
            if (appState.music.isPlaying) {
                // Pause
                if (appState.music.audio) {
                    appState.music.audio.pause();
                }
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
                appState.music.isPlaying = false;
            } else {
                // Play
                playCurrentTrack();
            }
        }

        function playCurrentTrack() {
            if (!appState.music.audio) {
                // Create new audio element
                appState.music.audio = new Audio();
                appState.music.audio.addEventListener('timeupdate', updateProgress);
                appState.music.audio.addEventListener('ended', nextTrack);
                appState.music.audio.addEventListener('loadedmetadata', updateDuration);
                appState.music.audio.addEventListener('error', handleAudioError);
            }
            
            const track = appState.music.tracks[appState.music.currentTrack];
            
            // Set source and volume
            appState.music.audio.src = track.url;
            appState.music.audio.volume = appState.music.volume;
            
            // Try to play
            appState.music.audio.play().then(() => {
                const playIcon = playBtn.querySelector('i');
                playIcon.classList.remove('fa-play');
                playIcon.classList.add('fa-pause');
                appState.music.isPlaying = true;
                
                // Update current track display
                document.getElementById('currentTrack').textContent = track.title;
                currentCover.src = track.cover;
                
                // Update playlist active state
                document.querySelectorAll('.playlist-item').forEach((item, index) => {
                    if (index === appState.music.currentTrack) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }).catch(e => {
                console.log('Error playing audio:', e);
                alert('Tidak dapat memutar audio. Pastikan browser mendukung fitur ini dan Anda online.');
            });
        }

        function updateProgress() {
            if (appState.music.audio) {
                const currentTimeVal = appState.music.audio.currentTime;
                const durationVal = appState.music.audio.duration || 1;
                const percent = (currentTimeVal / durationVal) * 100;
                
                progressBar.style.width = `${percent}%`;
                
                // Format time
                currentTime.textContent = formatTime(currentTimeVal);
            }
        }

        function updateDuration() {
            if (appState.music.audio) {
                const durationVal = appState.music.audio.duration || 1;
                duration.textContent = formatTime(durationVal);
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function handleAudioError() {
            console.log('Audio error occurred');
            alert('Terjadi kesalahan saat memutar audio. Pastikan Anda online dan file audio valid.');
        }

        function prevTrack() {
            appState.music.currentTrack--;
            if (appState.music.currentTrack < 0) {
                appState.music.currentTrack = appState.music.tracks.length - 1;
            }
            playCurrentTrack();
        }

        function nextTrack() {
            appState.music.currentTrack++;
            if (appState.music.currentTrack >= appState.music.tracks.length) {
                appState.music.currentTrack = 0;
            }
            playCurrentTrack();
        }

        function updateCurrentTrack() {
            const track = appState.music.tracks[appState.music.currentTrack];
            document.getElementById('currentTrack').textContent = track.title;
            currentCover.src = track.cover;
        }

        function uploadMusic(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const url = URL.createObjectURL(file);
            
            // Create playlist item
            const item = document.createElement('div');
            item.className = 'playlist-item';
            item.innerHTML = `
                <div class="playlist-item-info">
                    <div class="playlist-item-title">${file.name}</div>
                    <div class="playlist-item-artist">Uploaded</div>
                </div>
                <div class="playlist-item-duration">--:--</div>
            `;
            
            item.addEventListener('click', () => {
                // Set as current track
                appState.music.currentTrack = Array.from(playlist.children).indexOf(item);
                
                // Play the track
                if (appState.music.audio) {
                    appState.music.audio.src = url;
                    appState.music.audio.play();
                    const playIcon = playBtn.querySelector('i');
                    playIcon.classList.remove('fa-play');
                    playIcon.classList.add('fa-pause');
                    appState.music.isPlaying = true;
                    
                    // Update current track display
                    document.getElementById('currentTrack').textContent = file.name;
                    currentCover.src = "https://via.placeholder.com/300x300/4a90e2/ffffff?text=Custom";
                    
                    // Update playlist active state
                    document.querySelectorAll('.playlist-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                }
            });
            
            playlist.appendChild(item);
            
            // Add to tracks array
            appState.music.tracks.push({ 
                title: file.name, 
                artist: 'Uploaded',
                duration: '--:--',
                url: url,
                cover: "https://via.placeholder.com/300x300/4a90e2/ffffff?text=Custom"
            });
        }

        // Graph functions
        function resizeCanvas() {
            const container = graphCanvas.parentElement;
            graphCanvas.width = container.clientWidth;
            graphCanvas.height = container.clientHeight;
            drawGrid();
        }

        function setupGraph() {
            // Initial setup for graph
            drawGrid();
        }

        function drawGrid() {
            const width = graphCanvas.width;
            const height = graphCanvas.height;
            const scale = appState.graph.scale;
            const offsetX = appState.graph.offsetX;
            const offsetY = appState.graph.offsetY;

            ctx.clearRect(0, 0, width, height);

            // Draw grid
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;

            // Vertical lines
            for (let x = 0; x <= width; x += scale) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }

            // Horizontal lines
            for (let y = 0; y <= height; y += scale) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // Draw axes
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.lineWidth = 2;

            // X-axis
            ctx.beginPath();
            ctx.moveTo(0, height / 2 - offsetY);
            ctx.lineTo(width, height / 2 - offsetY);
            ctx.stroke();

            // Y-axis
            ctx.beginPath();
            ctx.moveTo(width / 2 + offsetX, 0);
            ctx.lineTo(width / 2 + offsetX, height);
            ctx.stroke();

            // Draw axis labels
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';

            // X-axis labels
            for (let x = -Math.floor(width / (2 * scale)); x <= Math.floor(width / (2 * scale)); x++) {
                if (x === 0) continue; // Skip origin
                const pixelX = width / 2 + offsetX + x * scale;
                if (pixelX > 0 && pixelX < width) {
                    ctx.fillText(x, pixelX, height / 2 - offsetY + 15);
                }
            }

            // Y-axis labels
            ctx.textAlign = 'right';
            for (let y = -Math.floor(height / (2 * scale)); y <= Math.floor(height / (2 * scale)); y++) {
                if (y === 0) continue; // Skip origin
                const pixelY = height / 2 - offsetY - y * scale;
                if (pixelY > 0 && pixelY < height) {
                    ctx.fillText(-y, width / 2 + offsetX - 10, pixelY + 4);
                }
            }

            // Draw origin
            ctx.textAlign = 'center';
            ctx.fillText('0', width / 2 + offsetX, height / 2 - offsetY + 15);

            // Draw functions
            drawFunctions();
        }

        function drawFunctions() {
            const width = graphCanvas.width;
            const height = graphCanvas.height;
            const scale = appState.graph.scale;
            const offsetX = appState.graph.offsetX;
            const offsetY = appState.graph.offsetY;

            // Draw each function
            appState.graph.functions.forEach(func => {
                ctx.beginPath();
                ctx.strokeStyle = func.color || '#3b82f6';
                ctx.lineWidth = 2;

                let firstPoint = true;
                for (let x = -width / 2; x <= width / 2; x += 1) {
                    const graphX = x;
                    const graphY = func.func(x / scale);
                    
                    if (isNaN(graphY) || !isFinite(graphY)) continue;
                    
                    const pixelX = width / 2 + offsetX + graphX;
                    const pixelY = height / 2 - offsetY - graphY * scale;
                    
                    if (firstPoint) {
                        ctx.moveTo(pixelX, pixelY);
                        firstPoint = false;
                    } else {
                        ctx.lineTo(pixelX, pixelY);
                    }
                }
                ctx.stroke();
            });
        }

        function plotFunction() {
            const input = document.getElementById('functionInput').value.trim();
            if (!input) return;
            
            try {
                // Simple function parser
                const funcStr = input
                    .replace(/\^/g, '**') // Replace ^ with ** for exponentiation
                    .replace(/sin/g, 'Math.sin')
                    .replace(/cos/g, 'Math.cos')
                    .replace(/tan/g, 'Math.tan')
                    .replace(/log/g, 'Math.log10')
                    .replace(/ln/g, 'Math.log')
                    .replace(/sqrt/g, 'Math.sqrt')
                    .replace(/abs/g, 'Math.abs');
                
                // Create function
                const func = new Function('x', `return ${funcStr};`);
                
                // Test function
                func(0);
                
                // Add to functions array
                appState.graph.functions.push({
                    expression: input,
                    func: func,
                    color: getRandomColor()
                });
                
                drawGrid();
                document.getElementById('functionInput').value = '';
            } catch (e) {
                alert('Fungsi tidak valid: ' + e.message);
            }
        }

        function clearGraph() {
            appState.graph.functions = [];
            drawGrid();
        }

        function zoomGraph(factor) {
            appState.graph.scale *= factor;
            drawGrid();
        }

        function resetGraphView() {
            appState.graph.scale = 20;
            appState.graph.offsetX = 0;
            appState.graph.offsetY = 0;
            drawGrid();
        }

        function handleCanvasWheel(e) {
            e.preventDefault();
            const factor = e.deltaY > 0 ? 0.9 : 1.1;
            appState.graph.scale *= factor;
            drawGrid();
        }

        let isDragging = false;
        let lastX, lastY;

        function handleCanvasMouseDown(e) {
            isDragging = true;
            lastX = e.clientX;
            lastY = e.clientY;
        }

        function handleCanvasMouseUp() {
            isDragging = false;
        }

        function handleCanvasMouseMove(e) {
            const rect = graphCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Calculate graph coordinates
            const graphX = (x - graphCanvas.width / 2 - appState.graph.offsetX) / appState.graph.scale;
            const graphY = (graphCanvas.height / 2 - y - appState.graph.offsetY) / appState.graph.scale;
            
            coordinateDisplay.textContent = `Koordinat: (${graphX.toFixed(2)}, ${graphY.toFixed(2)})`;
            
            // Handle panning
            if (isDragging) {
                const dx = e.clientX - lastX;
                const dy = e.clientY - lastY;
                appState.graph.offsetX += dx;
                appState.graph.offsetY += dy;
                lastX = e.clientX;
                lastY = e.clientY;
                drawGrid();
            }
        }

        function loadFormulaToGraph(formula) {
            // Clear existing functions
            appState.graph.functions = [];
            
            // Add the requested formula
            switch(formula) {
                case 'quadratic':
                    appState.graph.functions.push({
                        expression: 'x^2',
                        func: (x) => x * x,
                        color: getRandomColor()
                    });
                    break;
                case 'sin':
                    appState.graph.functions.push({
                        expression: 'sin(x)',
                        func: (x) => Math.sin(x),
                        color: getRandomColor()
                    });
                    break;
                case 'cos':
                    appState.graph.functions.push({
                        expression: 'cos(x)',
                        func: (x) => Math.cos(x),
                        color: getRandomColor()
                    });
                    break;
                case 'circle':
                    // Circle is not a function, so we'll plot y = sqrt(r^2 - x^2) for demonstration
                    appState.graph.functions.push({
                        expression: 'sqrt(r^2 - x^2)',
                        func: (x) => {
                            const r = 5; // radius
                            if (Math.abs(x) > r) return NaN;
                            return Math.sqrt(r * r - x * x);
                        },
                        color: getRandomColor()
                    });
                    appState.graph.functions.push({
                        expression: '-sqrt(r^2 - x^2)',
                        func: (x) => {
                            const r = 5; // radius
                            if (Math.abs(x) > r) return NaN;
                            return -Math.sqrt(r * r - x * x);
                        },
                        color: getRandomColor()
                    });
                    break;
                case 'energy':
                    // KE = 0.5 * m * v^2 (simplified to y = 0.5 * x^2)
                    appState.graph.functions.push({
                        expression: '0.5 * x^2',
                        func: (x) => 0.5 * x * x,
                        color: getRandomColor()
                    });
                    break;
                default:
                    // Default to a simple parabola
                    appState.graph.functions.push({
                        expression: 'x^2',
                        func: (x) => x * x,
                        color: getRandomColor()
                    });
            }
            
            drawGrid();
        }

        function getRandomColor() {
            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6', '#ec4899'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Calculator functions
        function appendToDisplay(value) {
            if (calcDisplay.textContent === '0' && value !== '.') {
                calcDisplay.textContent = value;
            } else {
                calcDisplay.textContent += value;
            }
        }

        function clearDisplay() {
            calcDisplay.textContent = '0';
        }

        function backspace() {
            if (calcDisplay.textContent.length === 1) {
                calcDisplay.textContent = '0';
            } else {
                calcDisplay.textContent = calcDisplay.textContent.slice(0, -1);
            }
        }

        function calculate() {
            try {
                let expression = calcDisplay.textContent
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/\^/g, '**');
                
                // Handle functions
                expression = expression.replace(/sin\(/g, 'Math.sin(');
                expression = expression.replace(/cos\(/g, 'Math.cos(');
                expression = expression.replace(/tan\(/g, 'Math.tan(');
                expression = expression.replace(/sqrt\(/g, 'Math.sqrt(');
                expression = expression.replace(/log\(/g, 'Math.log10(');
                expression = expression.replace(/ln\(/g, 'Math.log(');
                
                const result = eval(expression);
                const historyItem = `${calcDisplay.textContent} = ${result}`;
                
                // Add to history
                appState.calculatorHistory.unshift(historyItem);
                if (appState.calculatorHistory.length > 10) {
                    appState.calculatorHistory.pop();
                }
                
                // Update history display
                updateHistoryDisplay();
                
                // Add XP for using calculator
                addXp(1);
                
                calcDisplay.textContent = result;
            } catch (e) {
                calcDisplay.textContent = 'Error';
            }
        }

        function updateHistoryDisplay() {
            calcHistory.innerHTML = '';
            appState.calculatorHistory.forEach(item => {
                const div = document.createElement('div');
                div.textContent = item;
                div.style.padding = '5px 0';
                div.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                calcHistory.appendChild(div);
            });
            saveState();
        }

        // Unit converter
        function convertUnits() {
            const value = parseFloat(document.getElementById('convertValue').value);
            const fromUnit = document.getElementById('fromUnit').value;
            const toUnit = document.getElementById('toUnit').value;
            
            if (isNaN(value)) {
                document.getElementById('convertedValue').value = '';
                return;
            }
            
            // Conversion factors to meters
            const toMeters = {
                meter: 1,
                kilometer: 1000,
                centimeter: 0.01,
                inch: 0.0254,
                foot: 0.3048
            };
            
            // Convert to meters first
            const meters = value * toMeters[fromUnit];
            
            // Convert to target unit
            const result = meters / toMeters[toUnit];
            
            document.getElementById('convertedValue').value = result.toFixed(6);
        }

        function convertTemperature() {
            const celsius = parseFloat(document.getElementById('tempValue').value);
            
            if (isNaN(celsius)) {
                document.getElementById('tempResult').value = '';
                return;
            }
            
            // Celsius to Fahrenheit: (°C × 9/5) + 32
            const fahrenheit = (celsius * 9/5) + 32;
            
            document.getElementById('tempResult').value = fahrenheit.toFixed(2);
        }

        // XP and level system
        function addXp(amount) {
            appState.xp += amount;
            
            // Check for level up
            if (appState.xp >= appState.nextLevelXp) {
                appState.level++;
                appState.xp -= appState.nextLevelXp;
                appState.nextLevelXp = Math.floor(appState.nextLevelXp * 1.5); // Increase XP needed for next level
            }
            
            updateXpDisplay();
            saveState();
        }

        function updateXpDisplay() {
            document.getElementById('levelDisplay').textContent = appState.level;
            document.getElementById('xpDisplay').textContent = appState.xp;
            document.getElementById('nextLevelXp').textContent = appState.nextLevelXp;
            
            const progressPercent = (appState.xp / appState.nextLevelXp) * 100;
            document.getElementById('xpBar').style.width = `${progressPercent}%`;
        }

        // Notes functions
        function loadNotes() {
            // Notes are loaded from localStorage in loadState()
        }

        // Initialize the app when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            initApp();
        });
    </script>
</body>
</html>